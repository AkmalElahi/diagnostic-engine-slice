{
  "flow_id": "flow_2_water_system_issue",
  "flow_version": "1.0",
  "start_node": "capability_gate",
  "nodes": {
    "capability_gate": {
      "type": "QUESTION",
      "text": "You may need to check water system components, panels, or switches. Are you comfortable proceeding?",
      "yes": "clarify_water_source",
      "no": "terminal_capability_declined"
    },
    "clarify_water_source": {
      "type": "QUESTION",
      "text": "Are you currently connected to city water (external water hookup)?",
      "yes": "city_water_pressure_check",
      "no": "check_fresh_tank_status"
    },
    "city_water_pressure_check": {
      "type": "QUESTION",
      "text": "Do you see water flow from the city water source (hose connected and turned on)?",
      "yes": "check_symptom_scope_city",
      "no": "terminal_city_water_source_issue"
    },
    "check_symptom_scope_city": {
      "type": "QUESTION",
      "text": "Are ALL water fixtures affected (no water anywhere)?",
      "yes": "check_city_water_valve",
      "no": "terminal_partial_fixture_loss_city"
    },
    "check_city_water_valve": {
      "type": "QUESTION",
      "text": "Can you locate your city water inlet valve or connection?",
      "yes": "verify_city_water_valve",
      "no": "terminal_cannot_locate_city_valve"
    },
    "verify_city_water_valve": {
      "type": "QUESTION",
      "text": "Is the city water inlet valve fully open?",
      "yes": "check_water_filter",
      "no": "terminal_city_valve_closed"
    },
    "check_water_filter": {
      "type": "QUESTION",
      "text": "Do you have an inline water filter visible near the city water inlet?",
      "yes": "assess_filter_condition",
      "no": "check_water_pump_switch_city"
    },
    "assess_filter_condition": {
      "type": "QUESTION",
      "text": "Does the filter appear old, discolored, or clogged?",
      "yes": "terminal_filter_may_need_service",
      "no": "check_water_pump_switch_city"
    },
    "check_water_pump_switch_city": {
      "type": "QUESTION",
      "text": "Is your water pump switch in the OFF position?",
      "yes": "terminal_city_water_with_pump_interference",
      "no": "terminal_city_water_system_issue"
    },
    "check_fresh_tank_status": {
      "type": "QUESTION",
      "text": "Can you see your fresh water tank level indicator?",
      "yes": "verify_tank_level",
      "no": "check_pump_operation"
    },
    "verify_tank_level": {
      "type": "QUESTION",
      "text": "Does the tank indicator show water present (not empty)?",
      "yes": "check_pump_operation",
      "no": "terminal_fresh_tank_empty"
    },
    "check_pump_operation": {
      "type": "QUESTION",
      "text": "Is your water pump switch in the ON position?",
      "yes": "listen_for_pump",
      "no": "terminal_pump_switch_off"
    },
    "listen_for_pump": {
      "type": "QUESTION",
      "text": "When you turn on a faucet, do you hear the water pump running?",
      "yes": "check_pump_cycling",
      "no": "check_pump_breaker"
    },
    "check_pump_cycling": {
      "type": "QUESTION",
      "text": "Does the pump run continuously without stopping, or cycle on and off rapidly?",
      "yes": "terminal_pump_cycling_abnormally",
      "no": "check_fixture_scope"
    },
    "check_fixture_scope": {
      "type": "QUESTION",
      "text": "Are ALL fixtures affected (no water anywhere)?",
      "yes": "check_accumulator_tank",
      "no": "terminal_partial_fixture_loss_pump"
    },
    "check_accumulator_tank": {
      "type": "QUESTION",
      "text": "Do you have an accumulator tank (small pressurized tank near the pump)?",
      "yes": "assess_accumulator_pressure",
      "no": "terminal_complete_water_loss_pump"
    },
    "assess_accumulator_pressure": {
      "type": "QUESTION",
      "text": "Does the accumulator tank feel firm when gently pressed, or does it feel soft/empty?",
      "yes": "terminal_complete_water_loss_pump",
      "no": "terminal_accumulator_may_need_service"
    },
    "check_pump_breaker": {
      "type": "QUESTION",
      "text": "Can you locate the water pump fuse or breaker in your 12V panel?",
      "yes": "inspect_pump_breaker",
      "no": "terminal_pump_no_power_fuse_unknown"
    },
    "inspect_pump_breaker": {
      "type": "QUESTION",
      "text": "Is the water pump fuse or breaker intact and not tripped?",
      "yes": "check_pump_wiring_access",
      "no": "terminal_pump_breaker_tripped"
    },
    "check_pump_wiring_access": {
      "type": "QUESTION",
      "text": "Can you safely access the water pump location?",
      "yes": "verify_pump_connections",
      "no": "terminal_pump_no_access"
    },
    "verify_pump_connections": {
      "type": "QUESTION",
      "text": "Are the electrical connections to the pump secure and not corroded?",
      "yes": "terminal_pump_no_power_connection_ok",
      "no": "terminal_pump_connection_issue"
    },
    "terminal_capability_declined": {
      "type": "TERMINAL",
      "result": "User declined diagnostic requirements",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "User not comfortable with diagnostic requirements",
        "capability_gate": "{{capability_gate.value}}",
        "recommendations": [
          "Contact RV technician for on-site water system diagnosis",
          "Minimize water usage until diagnosed"
        ]
      }
    },
    "terminal_city_water_source_issue": {
      "type": "TERMINAL",
      "result": "City water source not providing flow",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "No water flow from city water source",
        "water_source": "City water",
        "city_water_flow": "{{city_water_pressure_check.value}}",
        "recommendations": [
          "Check if external water spigot is turned on",
          "Verify hose is not kinked or blocked",
          "Check hose connection at both ends",
          "If external source confirmed working, contact technician for inlet diagnosis"
        ]
      }
    },
    "terminal_city_valve_closed": {
      "type": "TERMINAL",
      "result": "City water inlet valve closed or partially closed",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "City water valve not fully open",
        "water_source": "City water",
        "city_water_flow": "{{city_water_pressure_check.value}}",
        "valve_status": "{{verify_city_water_valve.value}}",
        "recommendations": [
          "Open city water inlet valve fully",
          "If issue persists after opening valve, contact technician",
          "Valve may require service or replacement"
        ]
      }
    },
    "terminal_filter_may_need_service": {
      "type": "TERMINAL",
      "result": "Inline water filter may be restricting flow",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Filter appears clogged or old",
        "water_source": "City water",
        "city_water_flow": "{{city_water_pressure_check.value}}",
        "valve_status": "{{verify_city_water_valve.value}}",
        "filter_present": "{{check_water_filter.value}}",
        "filter_condition": "{{assess_filter_condition.value}}",
        "recommendations": [
          "Contact technician for filter inspection or replacement",
          "Do not remove filter without proper replacement available",
          "Filter service typically improves flow if clogged"
        ]
      }
    },
    "terminal_city_water_with_pump_interference": {
      "type": "TERMINAL",
      "result": "Water pump may be interfering with city water operation",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Pump switch on while using city water",
        "water_source": "City water",
        "city_water_flow": "{{city_water_pressure_check.value}}",
        "valve_status": "{{verify_city_water_valve.value}}",
        "pump_switch_status": "{{check_water_pump_switch_city.value}}",
        "recommendations": [
          "Turn water pump switch to OFF when using city water",
          "Pump operation on city water can cause backflow or check valve issues",
          "If issue persists with pump off, contact technician"
        ]
      }
    },
    "terminal_city_water_system_issue": {
      "type": "TERMINAL",
      "result": "City water system issue - cause not identified",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "City water flow present but no water at fixtures",
        "water_source": "City water",
        "city_water_flow": "{{city_water_pressure_check.value}}",
        "valve_status": "{{verify_city_water_valve.value}}",
        "filter_present": "{{check_water_filter.value}}",
        "pump_switch_status": "{{check_water_pump_switch_city.value}}",
        "symptom_scope": "{{check_symptom_scope_city.value}}",
        "recommendations": [
          "Check valve or plumbing restriction likely",
          "Contact technician for system pressure testing",
          "May require internal plumbing inspection"
        ]
      }
    },
    "terminal_partial_fixture_loss_city": {
      "type": "TERMINAL",
      "result": "Partial fixture loss on city water - fixture specific issue",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Some fixtures working, others not on city water",
        "water_source": "City water",
        "city_water_flow": "{{city_water_pressure_check.value}}",
        "symptom_scope": "Partial loss",
        "recommendations": [
          "Document which fixtures are affected",
          "Likely fixture-specific valve or aerator blockage",
          "Contact technician for fixture inspection",
          "Affected fixtures may have closed valves or clogged aerators"
        ]
      }
    },
    "terminal_cannot_locate_city_valve": {
      "type": "TERMINAL",
      "result": "Cannot locate city water inlet valve",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "City water valve not located",
        "water_source": "City water",
        "city_water_flow": "{{city_water_pressure_check.value}}",
        "recommendations": [
          "Consult owner's manual for valve location",
          "Valve typically near city water inlet connection",
          "Contact technician for valve location and inspection"
        ]
      }
    },
    "terminal_fresh_tank_empty": {
      "type": "TERMINAL",
      "result": "Fresh water tank appears empty",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Fresh water tank empty",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "recommendations": [
          "Fill fresh water tank",
          "If tank was recently filled, check for leaks",
          "If tank indicator incorrect, contact technician for sensor diagnosis"
        ]
      }
    },
    "terminal_pump_switch_off": {
      "type": "TERMINAL",
      "result": "Water pump switch in OFF position",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Pump switch OFF",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "recommendations": [
          "Turn water pump switch to ON position",
          "If pump does not run after switching ON, contact technician",
          "Pump may have power supply issue"
        ]
      }
    },
    "terminal_pump_cycling_abnormally": {
      "type": "TERMINAL",
      "result": "Water pump cycling abnormally",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Pump running continuously or rapid cycling",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "pump_sound": "{{listen_for_pump.value}}",
        "pump_cycling": "{{check_pump_cycling.value}}",
        "recommendations": [
          "Continuous running suggests leak or no pressure buildup",
          "Rapid cycling suggests pressure switch or accumulator issue",
          "Contact technician for pump and pressure system diagnosis",
          "Turn pump off when not in use to avoid damage"
        ]
      }
    },
    "terminal_pump_breaker_tripped": {
      "type": "TERMINAL",
      "result": "Water pump fuse blown or breaker tripped",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Pump circuit protection tripped",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "pump_sound": "{{listen_for_pump.value}}",
        "pump_breaker_status": "{{inspect_pump_breaker.value}}",
        "recommendations": [
          "Do not replace fuse or reset breaker without diagnosis",
          "Contact technician to diagnose overcurrent cause",
          "Pump may have internal short or overload condition"
        ]
      }
    },
    "terminal_pump_no_power_fuse_unknown": {
      "type": "TERMINAL",
      "result": "Pump not running - fuse location unknown",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Pump not running, fuse panel not located",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "pump_sound": "{{listen_for_pump.value}}",
        "recommendations": [
          "Consult owner's manual for pump fuse location",
          "Contact technician for pump power diagnosis",
          "Pump may have power supply or wiring issue"
        ]
      }
    },
    "terminal_pump_connection_issue": {
      "type": "TERMINAL",
      "result": "Pump electrical connection issue observed",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Pump connections loose or corroded",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "pump_sound": "{{listen_for_pump.value}}",
        "pump_breaker_status": "{{inspect_pump_breaker.value}}",
        "pump_connections": "{{verify_pump_connections.value}}",
        "recommendations": [
          "Contact technician to clean and secure pump connections",
          "Take photos before any work",
          "Corroded connections require proper service"
        ]
      }
    },
    "terminal_pump_no_power_connection_ok": {
      "type": "TERMINAL",
      "result": "Pump not running - connections appear normal",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Pump not running, electrical connections appear normal",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "pump_sound": "{{listen_for_pump.value}}",
        "pump_breaker_status": "{{inspect_pump_breaker.value}}",
        "pump_connections": "{{verify_pump_connections.value}}",
        "recommendations": [
          "Pump motor may have failed internally",
          "Contact technician for pump replacement or repair",
          "Requires voltage testing and pump diagnosis"
        ]
      }
    },
    "terminal_pump_no_access": {
      "type": "TERMINAL",
      "result": "Cannot access water pump location",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Pump location not accessible",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "pump_sound": "{{listen_for_pump.value}}",
        "pump_breaker_status": "{{inspect_pump_breaker.value}}",
        "recommendations": [
          "Contact technician for pump access and diagnosis",
          "Pump may be under furniture or in sealed compartment"
        ]
      }
    },
    "terminal_accumulator_may_need_service": {
      "type": "TERMINAL",
      "result": "Accumulator tank may need service",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Accumulator tank feels soft or empty",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "pump_sound": "{{listen_for_pump.value}}",
        "pump_cycling": "{{check_pump_cycling.value}}",
        "accumulator_present": "{{check_accumulator_tank.value}}",
        "accumulator_pressure": "{{assess_accumulator_pressure.value}}",
        "recommendations": [
          "Accumulator tank may have lost air pressure",
          "Contact technician for accumulator service",
          "Proper air pressure reduces pump cycling and improves flow"
        ]
      }
    },
    "terminal_complete_water_loss_pump": {
      "type": "TERMINAL",
      "result": "Complete water loss with pump running - system issue",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Pump running but no water at any fixture",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "pump_sound": "{{listen_for_pump.value}}",
        "pump_cycling": "{{check_pump_cycling.value}}",
        "symptom_scope": "Complete loss",
        "recommendations": [
          "Pump intake may be blocked or dry",
          "System may have large leak or valve closed",
          "Contact technician for system diagnosis",
          "Check for visible water leaks under RV"
        ]
      }
    },
    "terminal_partial_fixture_loss_pump": {
      "type": "TERMINAL",
      "result": "Partial fixture loss on pump - fixture specific issue",
      "artifact": {
        "issue": "Water system issue",
        "stop_reason": "Some fixtures working, others not on pump",
        "water_source": "Fresh tank / pump",
        "tank_level": "{{verify_tank_level.value}}",
        "pump_switch": "{{check_pump_operation.value}}",
        "pump_sound": "{{listen_for_pump.value}}",
        "pump_cycling": "{{check_pump_cycling.value}}",
        "symptom_scope": "Partial loss",
        "recommendations": [
          "Document which fixtures are affected",
          "Likely fixture-specific valve or blockage",
          "Contact technician for fixture inspection",
          "Affected fixtures may have closed valves or restrictions"
        ]
      }
    }
  }
}
